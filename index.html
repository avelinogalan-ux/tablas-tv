// =============================================
// FUNCIÓN SIMPLE PARA ENVIAR A TV
// =============================================

function enviarDatosTV(tipo) {
    if (puestoes.length === 0) {
        mostrarInfoControl('No hay datos para enviar', 'warning');
        return;
    }

    try {
        let datos;
        
        if (tipo === 'finales') {
            // Calcular resultados finales para Pistola Libre
            datos = puestoes
                .filter(t => !t.abandonado)
                .map(t => {
                    let total = 0;
                    const seriesData = [];
                    let totalX = 0;

                    for (let s = 1; s <= 6; s++) {
                        const totalSerie = calcularTotalSerie(t.series[s]);
                        const xSerie = contarXSerie(t.series[s]);
                        seriesData.push(totalSerie);
                        total += totalSerie;
                        totalX += xSerie;
                    }

                    return {
                        puesto: t.id,
                        series: seriesData,
                        total: total,
                        xTotal: totalX,
                        abandonado: t.abandonado
                    };
                })
                .sort((a, b) => b.total - a.total);
                
        } else {
            // Estado actual para Pistola Libre
            datos = {
                puestos: puestoes.map(t => ({
                    id: t.id,
                    abandonado: t.abandonado,
                    serieActual: serieActual,
                    series: Object.keys(t.series).reduce((acc, s) => {
                        acc[s] = {
                            total: calcularTotalSerie(t.series[s]),
                            completada: t.series[s].every(d => d !== null),
                            disparos: t.series[s]
                        };
                        return acc;
                    }, {})
                }))
            };
        }

        const datosEnvio = {
            tipo: tipo,
            disciplina: 'Pistola Libre',
            timestamp: new Date().toISOString(),
            datos: datos
        };

        // Guardar en localStorage para que la TV lo recoja
        localStorage.setItem('tvData', JSON.stringify(datosEnvio));
        sessionStorage.setItem('currentTVData', JSON.stringify(datosEnvio));
        
        mostrarInfoControl(`✅ Datos enviados a TV (${tipo})`, 'success');
        
    } catch (error) {
        mostrarInfoControl('Error al enviar datos: ' + error.message, 'danger');
    }
}

// Reemplazar las funciones existentes
function enviarResultadosFinalesTV() {
    enviarDatosTV('finales');
}

function enviarResumenActualTV() {
    enviarDatosTV('actual');
}
