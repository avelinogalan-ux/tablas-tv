<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV - Resultados Tiro Deportivo</title>    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #212529; color: white; min-height: 100vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container-tv { max-width: 1600px; margin: 0 auto; padding: 15px; }
        .table { font-size: 1.2rem; border-color: #454d55; vertical-align: middle; }
        .table th, .table td { text-align: center; padding: 0.8rem; }
        .table-light-warning { background-color: #fff3cd !important; color: #664d03 !important; }
        .esperando-datos { display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 60vh; text-align: center; color: #bdc3c7; }
        .status-connected { background: rgba(46, 204, 113, 0.2); border: 1px solid #2ecc71; color: #2ecc71; }
        .status-disconnected { background: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c; color: #e74c3c; }
        .status-waiting { background: rgba(241, 196, 15, 0.2); border: 1px solid #f1c40f; color: #f1c40f; }
    </style>
</head>
<body>
    <div class="container-tv">
        <header class="text-center my-4">
            <h1 class="display-4 mb-3">üéØ Resultados en Directo</h1>
            <div id="infoActualizacion" class="status-waiting p-3 rounded mx-auto" style="max-width: 600px;">
                <div class="d-flex align-items-center justify-content-center">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    <span>Buscando canal de competici√≥n...</span>
                </div>
            </div>
        </header>
        <main id="contenido">
            <div class="esperando-datos" id="esperando">
                <div class="spinner-border text-primary mb-3" style="width: 4rem; height: 4rem;"></div>
                <h4>Listo para recibir resultados</h4>
                <p class="text-muted">Los datos aparecer√°n autom√°ticamente en esta pantalla.</p>
            </div>
            <div id="tablasContainer" style="display: none;"></div>
        </main>
    </div>

<script>
    const CANAL_UNIVERSAL_ID = '68e19505ae596e708f063783';
    let ultimoContenido = '';

    async function consultarCanal() {
        const infoElement = document.getElementById('infoActualizacion');
        try {
            const respuesta = await fetch(`https://api.jsonbin.io/v3/b/${CANAL_UNIVERSAL_ID}/latest`);
            if (!respuesta.ok) { throw new Error(`Error ${respuesta.status}`); }
            const contenidoTexto = await respuesta.text();
            if (contenidoTexto === ultimoContenido) return;
            ultimoContenido = contenidoTexto;
            const datos = JSON.parse(contenidoTexto).record;
            if (!datos || !datos.tipo) return;

            mostrarResultadosTV(datos);
            document.getElementById('esperando').style.display = 'none';
            document.getElementById('tablasContainer').style.display = 'block';

            const ahora = new Date();
            infoElement.className = 'status-connected p-3 rounded mx-auto';
            infoElement.innerHTML = `<div class="text-center"><span class="fw-bold">‚úÖ EN DIRECTO</span><br><small>√öltima Actualizaci√≥n: ${ahora.toLocaleTimeString()} | ${datos.disciplina.toUpperCase()}</small></div>`;
        } catch (error) {
            console.error("‚ùå Error al buscar datos:", error);
            infoElement.className = 'status-disconnected p-3 rounded mx-auto';
            infoElement.innerHTML = `<div class="text-center">‚ùå Error al recibir datos. Verificando...</div>`;
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        consultarCanal();
        setInterval(consultarCanal, 10000);
    });

    function mostrarResultadosTV(datos) {
        const container = document.getElementById('tablasContainer');
        container.innerHTML = '';
        if (datos.tipo === 'finales') crearTablaFinales(datos.datos, container, datos.disciplina);
        else if (datos.tipo === 'parciales') crearTablaParciales(datos.datos, container, datos.disciplina);
    }

    function crearTablaFinales(resultados, container, disciplina) {
        let tablaHTML = `<h1 class="text-center mb-4">${disciplina} - Clasificaci√≥n Final</h1><table class="table table-dark table-striped table-bordered table-hover"><thead class="table-primary"><tr><th>Pos.</th><th>Puesto</th><th>S1</th><th>S2</th><th>S3</th><th>S4</th><th>S5</th><th>S6</th><th class="table-warning">S7</th><th class="table-warning">S8</th><th class="table-warning">S9</th><th class="table-warning">S10</th><th class="table-warning">S11</th><th class="table-warning">S12</th><th class="table-success">Total</th><th class="table-info">X</th></tr></thead><tbody>`;
        resultados.forEach((r, index) => {
            tablaHTML += `<tr><td class="fw-bold">${index + 1}¬∫</td><td>Puesto ${r.puesto}</td>${r.series.map((s, i) => `<td class="${i < 6 ? '' : 'table-light-warning'}">${s}</td>`).join('')}<td class="table-success fw-bold">${r.total}</td><td class="table-info fw-bold">${r.xTotal}</td></tr>`;
        });
        tablaHTML += '</tbody></table>';
        container.innerHTML = tablaHTML;
    }

    function crearTablaParciales(resultados, container, disciplina) {
        let tablaHTML = `<h1 class="text-center mb-4">${disciplina} - Clasificaci√≥n Parcial</h1><table class="table table-dark table-striped table-bordered table-hover"><thead class="table-primary"><tr><th>Pos.</th><th>Puesto</th><th>Prec. 1</th><th>Prec. 2</th><th>Prec. 3</th><th class="table-warning">Duelo 1</th><th class="table-warning">Duelo 2</th><th class="table-warning">Duelo 3</th><th class="table-success">Total</th><th class="table-info">X</th></tr></thead><tbody>`;
        resultados.forEach((r, index) => {
            tablaHTML += `<tr><td class="fw-bold">${index + 1}¬∫</td><td>Puesto ${r.puesto}</td>${r.parciales.map((p, i) => `<td class="${i < 3 ? '' : 'table-light-warning'}">${p}</td>`).join('')}<td class="table-success fw-bold">${r.total}</td><td class="table-info fw-bold">${r.xTotal}</td></tr>`;
        });
        tablaHTML += '</tbody></table>';
        container.innerHTML = tablaHTML;
    }
</script>

</body>
</html>

