<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Puntuaci√≥n - Visor</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéØ</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        /* Aqu√≠ va todo tu CSS, incluyendo las Media Queries que ya te proporcion√© */
        body { background: radial-gradient(circle at center, #000428 0%, #004e92 100%); color: #fff; font-family: 'Rajdhani', sans-serif; margin:0; padding:0; min-height: 100vh; }
        /* ... Pega el resto de tu CSS aqu√≠ ... */
        @media (max-width: 480px) {
            .header { padding: 1rem 0.5rem; }
            .posicion-grande { font-size: 2rem; padding: 0.3rem 0.6rem; margin-bottom: 0.5rem; }
            .posicion-rival { font-size: 1.2rem; padding: 0.2rem 0.5rem; }
            .nombre-rival { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

<!-- Modal de Acceso por Puesto y PIN -->
<div class="modal fade" id="modalConfigVisor" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white" style="backdrop-filter: blur(10px); background: rgba(0,20,50,0.95) !important; border: 3px solid #007bff;">
      <div class="modal-header" style="border-bottom: 3px solid #ffc107;">
        <h5 class="modal-title" style="font-size: 1.5rem;"><i class="bi bi-shield-lock-fill"></i> Acceso Tirador</h5>
      </div>
      <div class="modal-body">
        <div class="mb-4">
          <label class="form-label fw-bold" style="font-size: 1.1rem;">üë§ Tu N√∫mero de Puesto</label>
          <input type="number" id="miPuestoInput" class="form-control form-control-lg text-center" placeholder="Ej: 7" required style="background: rgba(255,255,255,0.1); border: 2px solid #ffc107; color: #fff; font-size: 1.5rem;">
        </div>
        <div class="mb-4">
          <label class="form-label fw-bold" style="font-size: 1.1rem;">üîê Tu PIN Secreto (4 d√≠gitos)</label>
          <input type="password" id="miPinInput" class="form-control form-control-lg text-center" maxlength="4" inputmode="numeric" pattern="[0-9]*" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required style="background: rgba(255,255,255,0.1); border: 2px solid #007bff; color: #fff; font-size: 1.5rem;">
        </div>
        <h6 class="text-white-50 mt-4">¬øQuieres seguir a alg√∫n rival? (Opcional)</h6>
        <div class="mb-4">
          <label class="form-label fw-bold" style="font-size: 1.1rem;">üéØ Rival 1</label>
          <select id="rival1" class="form-select" disabled style="background: rgba(128,128,128,0.1); border: 2px solid #6c757d; color: #6c757d;">
            <option value="">-- Valida tu PIN primero --</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="form-label fw-bold" style="font-size: 1.1rem;">üéØ Rival 2</label>
          <select id="rival2" class="form-select" disabled style="background: rgba(128,128,128,0.1); border: 2px solid #6c757d; color: #6c757d;">
            <option value="">-- Valida tu PIN primero --</option>
          </select>
        </div>
        <button class="btn w-100" onclick="validarYComenzar()" style="background: linear-gradient(90deg, #ffc107, #ff9800); border: none; color: #000; font-weight: 700; font-size: 1.2rem; padding: 0.8rem;">
          <i class="bi bi-box-arrow-in-right"></i> Entrar
        </button>
        <div id="errorConfig" class="text-danger text-center mt-3 fw-bold" style="min-height: 24px;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Contenido principal (igual que antes) -->
<div id="mainContent" style="display: none;">
    <!-- ... Pega aqu√≠ tu #mainContent ... -->
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const DATOS_COMPETICION_BIN_ID = 'TU_BIN_ID_AQUI'; // Reemplaza con el ID de tu bin
    const INTERVALO_ACTUALIZACION = 10000;
    
    let modalConfigVisor;
    let datosCompletos = null;
    let configuracion = { miPuesto: null, rival1: null, rival2: null };
    let intervaloActualizacion;

    document.addEventListener('DOMContentLoaded', () => {
        modalConfigVisor = new bootstrap.Modal('#modalConfigVisor');
        modalConfigVisor.show();
    });

    async function validarYComenzar() {
        const miPuestoInput = document.getElementById('miPuestoInput').value.trim();
        const miPinInput = document.getElementById('miPinInput').value.trim();
        const errorDiv = document.getElementById('errorConfig');
        errorDiv.textContent = '';

        if (!miPuestoInput || !miPinInput || miPinInput.length !== 4) {
            errorDiv.textContent = 'Debes introducir tu puesto y un PIN de 4 d√≠gitos.';
            return;
        }

        try {
            const response = await fetch(`https://api.jsonbin.io/v3/b/${DATOS_COMPETICION_BIN_ID}/latest`);
            datosCompletos = (await response.json()).record;

            const tiradorValidado = datosCompletos.datos.find(
                t => String(t.puesto) === miPuestoInput && String(t.pin) === miPinInput
            );

            if (!tiradorValidado) {
                errorDiv.textContent = 'Puesto o PIN incorrecto. Int√©ntalo de nuevo.';
                return;
            }

            poblarSelectoresRivales(datosCompletos.datos, miPuestoInput);
            
            configuracion.miPuesto = miPuestoInput;
            configuracion.rival1 = document.getElementById('rival1').value || null;
            configuracion.rival2 = document.getElementById('rival2').value || null;
            
            modalConfigVisor.hide();
            document.getElementById('mainContent').style.display = 'block';
            iniciarSeguimiento();

        } catch (error) {
            console.error('Error de validaci√≥n:', error);
            errorDiv.textContent = 'Error de conexi√≥n con el servidor.';
        }
    }

    function poblarSelectoresRivales(datos, miPuesto) {
        const selectRival1 = document.getElementById('rival1');
        const selectRival2 = document.getElementById('rival2');
        
        // Habilitar y limpiar selectores
        selectRival1.disabled = false;
        selectRival2.disabled = false;
        selectRival1.style.background = "rgba(255,255,255,0.1)"; selectRival1.style.color = "#fff";
        selectRival2.style.background = "rgba(255,255,255,0.1)"; selectRival2.style.color = "#fff";
        
        selectRival1.innerHTML = '<option value="">-- No seguir a nadie --</option>';
        selectRival2.innerHTML = '<option value="">-- No seguir a nadie --</option>';
        
        datos.sort((a, b) => a.puesto - b.puesto).forEach(tirador => {
            if (String(tirador.puesto) !== String(miPuesto)) {
                const option = `<option value="${tirador.puesto}">Puesto ${tirador.puesto}</option>`;
                selectRival1.innerHTML += option;
                selectRival2.innerHTML += option;
            }
        });
    }

    // El resto de funciones (iniciarSeguimiento, cargarYMostrarDatos, mostrarDatos, crearCardPrincipal, etc.)
    // se mantienen IGUAL que en la versi√≥n final que ya ten√≠as.
    // ...
</script>

</body>
</html>
